package com.example.application.views.incidencia;

import javax.annotation.security.RolesAllowed;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.PageRequest;

import com.example.application.data.entity.Incidencia;
import com.example.application.data.service.IncidenciaService;
import com.example.application.views.MainLayout;
import com.vaadin.flow.component.Component;
import com.vaadin.flow.component.grid.Grid;
import com.vaadin.flow.component.grid.GridVariant;
import com.vaadin.flow.component.html.Div;
import com.vaadin.flow.component.html.H3;
import com.vaadin.flow.component.orderedlayout.HorizontalLayout;
import com.vaadin.flow.router.PageTitle;
import com.vaadin.flow.router.Route;
import com.vaadin.flow.spring.data.VaadinSpringDataHelpers;

@PageTitle("Todos los comunicados                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ")
@Route(value = "incidence-admin-form", layout = MainLayout.class)
@RolesAllowed("ADMIN")
public class IncidenciaAdminView extends Div{
	
    Grid<Incidencia> grid = new Grid<>(Incidencia.class, false);
    
    private Incidencia incidencia;
	private final IncidenciaService service;
	
	@Autowired
	public IncidenciaAdminView(IncidenciaService service) {
		this.service = service;
		addClassName("incidencia-admin-view");
		
		add(createTitle());
		add(createGridLayout());
		
		grid.addColumn(autor -> autor.getAutor().getFullName()).setAutoWidth(true);
        grid.addColumn("motivo").setAutoWidth(true);
        grid.addColumn("incidencia").setAutoWidth(true);
        grid.addColumn("descripcion").setAutoWidth(true);
        grid.setItems(query -> service.list(
                PageRequest.of(query.getPage(), query.getPageSize(), VaadinSpringDataHelpers.toSpringDataSort(query)))
                .stream()
        			);
        grid.addThemeVariants(GridVariant.LUMO_NO_BORDER);
	}
	
	private Component createGridLayout() {
		HorizontalLayout gridLayout = new HorizontalLayout();
        gridLayout.setClassName("grid-layout");
        gridLayout.add(grid);
        return gridLayout;
    }
	
	private Component createTitle() {
		return new H3("   Lista de incidencias");
	}
	
	private void refreshGrid() {
        grid.select(null);
        grid.getDataProvider().refreshAll();
    }
	
}
